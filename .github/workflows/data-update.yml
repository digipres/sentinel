on:
  push:
     branches:
       - master
  schedule:
    # Attempt to refresh the site every morning.
    # * is a special character in YAML so you have to quote this string
    - cron:  '0 3 * * *'

jobs:
  update-digipresorg-site:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: true

      - name: Install 7-Zip
        run: sudo apt-get install -y p7zip-full p7zip-rar

      - name: Decrypt credentials...
        run: ./decrypt_secrets.sh
        env:
          FFW_PASSWORDFILE_SECRET: ${{ secrets.FFW_PASSWORDFILE_SECRET }}

      - name: Setup Git configuration...
        run: ./setup_git.sh

      - name: Setup Python environment...
        run: ./setup.sh

      - name: Update from various data sources...
        run: ./update.sh

      - name: Deploy updated site...
        run: ./deploy.sh


